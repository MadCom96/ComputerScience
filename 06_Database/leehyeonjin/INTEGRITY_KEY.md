# 데이터 무결성과 Key

---

### 데이터의 무결성

데이터의 정확성과 일관성을 유지하고 보증하는 것.

데이터의 무결성을 유지하는 것은 DBMS의 중요한 기능이며, 주로 데이터에 적용되는 연산에 제한을 두어 데이터 무결성을 유지 ⇒ 무결성이 유지되어야 DB에 저장된 값과 실제의 값이 일치하는지를 보장할 수 있기 때문.
</br></br>

**데이터 무결성 종류**

1. 개체 무결성(Entity Integrity)
- 모든 테이블이 기본키로 선택된 컬럼을 가져야 함.
- 기본키로 선택된 컬럼은 고유한 값을 가져야 하며, 빈 값은 허용하지 않음.

2. 참조 무결성(Referential Integrity)
- 참조 관계의 두 테이블의 데이터가 항상 일관된 값을 갖도록 유지되는 것.
- Ex. 아래의 두 참조관계의 테이블에서 department의 Mathematics 데이터가 삭제된다면, student 테이블의 3번째 행은 더이상 존재하지 않는 데이터를 참조하게 됨 ⇒ 참조 무결성 위반.

<img width="757" alt="Untitled" src="https://github.com/PragmaticArchive/ComputerScience/assets/90823532/c88b1860-e171-462c-8ceb-ab4a9804e182">

3. 도메인 무결성(Domain Integrity)
- 테이블에 존재하는 필드의 무결성을 보장하기 위한 것.
- 필드의 타입, null값 허용 등에 대한 사항을 정의하고 올바른 데이터가 입력되었는지 확인.
- Ex. 주민등록번호에 알파벳이 입력되는 경우 ⇒ 도메인 무결성 위반.

---

### 키(Key)

검색, 정렬시 튜플을 구분할 수 있는 기준이 되는 속성.

키들은 데이터베이스에서 데이터의 무결성을 유지하기 위한 수단으로 이용됨.

<img width="757" alt="Untitled" src="https://github.com/PragmaticArchive/ComputerScience/assets/90823532/c88b1860-e171-462c-8ceb-ab4a9804e182">

**1. 후보키(candidate key)**

기본키로 사용할 수 있는 속성들.

튜플을 유일하게 식별하기 위해 사용하는 속성들의 부분 집합.

1. 유일성 : 키로 하나의 튜플을 유일하게 식별가능해야 함.
2. 최소성 : 꼭 필요한 속성으로만 구성.
- student 테이블의 dept_id와 name 컬럼은 중복될 수 있으므로(유일성 위반) 후보키로 사용 불가.
- student 테이블의 id만으로도 튜플을 식별할 수 있으므로 id + dept_id 혹은 id + name(최소성 위반) 후보키로 사용 불가.
</br></br>

**2. 기본키(primary key)**

후보키 중 선택된 메인키.

1. Null 값을 가질 수 없음.
2. 동일한 값이 중복될 수 없음.

> 💡 **기본키 설정시 고려하면 좋은 것들**
>
> - 값이 자주 변경되지 않는 것을 선택 : 기본키로 선택된 필드는 값이 변경될 때마다 해당 값이 유일한지, null값은 아닌지를 검사해야하기 때문에 자주 변경되지 않는 컬럼을 기본키로 설정하는 것이 바람직.
> - 값이 단순한 것을 선택 : 기본키로 선택된 필드에 저장되는 데이터가 많은 많은 자릿수를 갖는 정수거나 문자열이라면, 기본키를 비교할 때 그만큼 많은 비용이 소모되기 때문.

</br>

**3. 대체키(alternate key)**

후보키 중 기본키를 제외한 나머지 키.
</br></br>

**4. 슈퍼키(super key)**

유일성을 만족하지만, 최소성은 만족하지 못하는 키.

- student 테이블에서 dept_id와 name은 중복가능한 컬럼이므로, 유일성은 만족하지 못하므로 슈퍼키로 사용 불가.
- 그러나 id + dept_id 혹은 id + name은 최소성은 만족하지 못하지만, id로 인해 유일성은 만족하므로 슈퍼키가 될 수 있음.
</br></br>

**5. 복합키(composite key)**

한 개 이상의 필드를 포함하는 키.
</br></br>

**6. 외래키(foreign key)**

다른 테이블의 레코드를 유일하게 식별 가능.

한 테이블의 레코드에서 다른 테이블의 레코드를 참조하기 위해 이용됨.

1. 하나의 필드 또는 전체 필드의 부분집합으로 구성됨.
2. 중복된 값과 null값을 가질 수 있음.
3. 반드시 참조되는 테이블에서 유일한 값을 갖는 필드를 참조해야 함.
4. 참조되는 테이블에 존재하는 값만을 가져야 함.
- null 값은 예외.

> 💡 외래키와 참조 무결성
> 
> 데이터베이스에서는 참조 무결성을 위해 참조 대상이 존재하지 않는 외래키를 허용하지 않음.</br>
> 이에 외래키는 참조 무결성을 지키기 위해 RESTRICTED, CASCADE, SET NULL이라는 개념을 외래키에 적용할 수 있는 기능을 제공함.
>
> - RESTRICTED : 레코드를 변경 또는 삭제하고자 할 때 해당 레코드를 참조하고 있는 개체가 있다면, 변경 또는 삭제 연산을 취소.
> - CASCADE : 레코드를 변경 또는 삭제하면, 해당 레코드를 참조하고 있는 개체도 변경 또는 삭제.
> - SET NULL : 레코드를 변경 또는 삭제하면, 해당 레코드를 참조하고 있는 개체의 값을 null로 설정.
